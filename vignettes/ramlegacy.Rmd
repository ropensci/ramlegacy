---
title: 'Introduction to ramlegacy'
author: "Carl Boettiger & Kshitiz Gupta" 
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: |
  %\VignetteIndexEntry{ramlegacy}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
## RAM Legacy Stock Assessment Database
From the database's [website](www.ramlegacy.org):

> The RAM Legacy Stock Assessment Database is a compilation of stock assessment results for commercially exploited marine populations from around the world. It is inspired by Dr. Ransom A. Myers' original [stock-recruitment database](http://www.mathstat.dal.ca/~myers/welcome.html), which is no longer being updated."

Different versions of the database are available in compressed (zipped) form on the [website](www.ramlegacy.org) in two formats: **Access** (Microsoft Office Access 2007 file format)  and **Excel** (Microsoft Excel Open XML Format Spreadsheet). As of March 2019, the available versions are 1.0, 2.0, 2.5, 3.0, 4.3, and 4.40, 4.41, 4.44.

## About the package
The goal of `ramlegacy` is to cache the specified version/versions of the RAM Legacy Stock Assessment Excel Database and this way save time and effort spent in re-downloading different
versions of the database as part of any future analysis involving the data. The package also supports reading in any specified dataframe(s) of the database through a function called `load_ramlegacy()`. The user can always view the location to which the database is cached and read from by running `ram_dir()` and specifying its version argument. This vignette will outline a few more details about these functions and the package that will hopefully make `ramlegacy` easy to use.

## Package Installation
You can install the development version from [GitHub](https://github.com/kshtzgupta1/ramlegacy) with the `install_github` function available in `devtools` package:

```{r, eval = FALSE, echo = TRUE}
install.packages("devtools")
library(devtools)
install_github("kshtzgupta1/ramlegacy")
```

To ensure that the vignette is installed along with the package make sure to remove `--no-build-vignettes` from the `build_opts` in `install_github`

## download_ramlegacy
You can download any available version of the RAM Legacy Stock Assessment Excel Database through `download_ramlegacy()` and specifying the version argument:

```{r, download_ramlegacy_example1, eval=FALSE, echo = T}
# download version 1.0
download_ramlegacy(version = "1.0")

# download version 2.0
download_ramlegacy(version = "2.0")

# download version 2.5
download_ramlegacy(version = "2.5")

# download version 3.0
download_ramlegacy(version = "3.0")

# download version 4.3
download_ramlegacy(version = "4.3")
```

If version is not specified then `download_ramlegacy` will default to downloading the
latest version of the database:

```{r, download_ramlegacy_example2, echo = T, eval = F}
# downloads latest version (currently 4.44)
download_ramlegacy()
```
If you want to download multiple versions please download them one at a time as passing them all at once will throw an error.

To enable caching behavior, before downloading a the specified version `download_ramlegacy` checks whether that version has already been downloaded. If it is then `download_ramlegacy` gives the user the option to either download again and overwrite the existing version or not download and just exit the function. This behavior is modified if `overwrite`, a function argument to `download_ramlegacy`, is set to true. Then even if the version has already been downloaded calling `download_ramlegacy` will download it again overwriting the already present version. After downloading the database download_ramlegacy caches it by converting it to an RDS object which can then be read in through calling `load_ramlegacy()`. 

`download_ramlegacy` also has three other arguments: `ram_path`, `ram_url`, and `quiet`. By default `ram_path` has been set to a location provided by the rappdirs package and can be viewed by calling `ram_dir(vers = "version")`. Although this is not the recommended approach download_ramlegacy supports downloading to a user-specified path. `ram_url` is fixed to the zenodo URL of the database. Please do not **pass in any other url** to ram_url. By default, `download_ramlegacy` after it is called keeps the user updated of the download progress through status messages. Setting `quiet` to TRUE enables the user suppress all status messages.
  
## load_ramlegacy
Use `load_ramlegacy` to obtain a list of particular dataframes or of all the dataframes present in the desired version of the database. Make sure that the version you want to load was downloaded and is already present locally otherwise `load_ramlegacy` will throw an error.

```{r, load_ramlegacy_example1, echo = T, eval = F}
# loads in area and bioparams tables from version 4.44 database
load_ramlegacy(version = "4.44", tables = c("area", "bioparams"))
```

In case in you want to load multiple versions please load them one at a time as passing them all at once will throw an error. Similar, to `download_ramlegacy`, `load_ramlegacy` has a `ram_path` argument which is set to local directory where the specified version of the RAM Legacy Stock Excel Assessment Database was downloaded. You can view that path through `ram_dir(vers = "version")`. Although this is not the recommended approach load_ramlegacy supports reading in the database's dataframes from a user-specified path provided that the database is present at the specified path as an rds file.
  
## ram_dir
To see the path where the specified version of database was downloaded on the user's computer, the user can call `ram_dir`. Note that this is also the location from which `load_ramlegacy` reads in the database. 

For example, to see where version 4.3 of the database was downloaded you can call:

```{r, ram_dir_example1, echo = T, eval = F}
# view the path where version 4.3 of the database was cached
ram_dir(vers = "4.3")
```


